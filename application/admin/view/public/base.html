<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>{$meta_title} | CuiCMF管理系统</title>
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <!-- Bootstrap,Font Awesome字体,Ionicons字体图标,AdminLTE核心样式,_all-skins皮肤,googleapis字体库,选择框控件 -->
        {css href="__CSS__/bootstrap.min.css" /}
        {css href="__CSS__/font-awesome/css/font-awesome.min.css" /}
        {css href="__CSS__/Ionicons/css/ionicons.min.css" /}
        {css href="__CSS__/googleapis/googleapis.css" /}
        <!--[if lt IE 9]>
        {js href="__JS__/html5shiv.min.js,__JS__/html5shiv.min.js" /}
        {js href="__JS__/html5shiv.min.js,__JS__/respond.min.js" /}
        <![endif]-->
        <!-- 扩展样式 -->
        {block name="style"}{/block}
        <!-- 扩展样式 -->
        {css href="__CSS__/AdminLTE.min.css" /}
        {css href="__CSS__/skins/_all-skins.min.css" /}
        <!-- layer弹窗 -->
        {css href="__STATIC__/layer/theme/default/layer.css" /}
        <!-- 自定义样式 -->
        {css href="__CSS__/common.css" /}
    </head>
    <body>
        {block name="body"}
        <div class="wrapper">
            {block name="top"}
            <!-- 头部导航 --> 
            <header class="main-header">
                <a href="" class="logo">
                    <span class="logo-mini"><b>C</b>CMF</span>
                    <span class="logo-lg"><b>Cui</b>CMF</span>
                </a>
                <nav class="navbar navbar-static-top" role="navigation">
                    <a href="javascript:;" class="sidebar-toggle" data-toggle="push-menu" role="button">
                        <span class="sr-only">Toggle navigation</span>
                    </a>
                    <div class="navbar-custom-menu">
                        <ul class="nav navbar-nav">
                            <li class="dropdown messages-menu">
                                <a href="{:url('System/clear')}" class="dropdown-toggle clear">
                                    <i class="fa fa-refresh"></i> 清空缓存
                                </a>
                            </li>
                            <li class="dropdown user user-menu">
                                <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown">
                                    <img src="__IMG__/user_img.png" class="user-image" alt="User Image">
                                    <span class="hidden-xs">{:user_auth('nickname')}</span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li class="user-header">
                                        <img src="__IMG__/user_img.png" class="img-circle" alt="用户头像">
                                        <p>
                                            {:user_auth('nickname')} - {if user_auth('uid') == $Think.config.config.user_administrator}系统管理员{else /}{:group_id(user_auth('uid'))}{/if}
                                            <small>最后一次登录时间：{:date('Y-m-d H:i', user_auth('last_login_time'))}</small>
                                        </p>
                                    </li>
                                    <li class="user-footer">
                                        <div class="pull-left">
                                            <a href="javascript:;" class="btn btn-default btn-flat" data-toggle="modal" data-target="#modal-change-password">修改密码</a>
                                        </div>
                                        <div class="pull-right">
                                            <a href="{:url('Login/logout')}" class="btn btn-default btn-flat ajax-get">退出</a>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                            <!-- 设置按钮 -->
                            <li>
                                <a href="javascript:;" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
                            </li>
                            <!-- /设置按钮 -->
                        </ul>
                    </div>
                </nav>
            </header>
            <!-- /头部导航 --> 
            {/block}
            {block name="left"}
            <!-- 左侧导航 --> 
            <aside class="main-sidebar">
                <section class="sidebar">
                    <div class="user-panel">
                        <div class="pull-left image">
                            <img src="__IMG__/user_img.png" class="img-circle" alt="User Image">
                        </div>
                        <div class="pull-left info">
                            <p>{:user_auth('nickname')}</p>
                            <a href="javascript:;"><i class="fa fa-circle text-success"></i> {if user_auth('uid') == $Think.config.config.user_administrator}系统管理员{else /}{:group_id(user_auth('uid'))}{/if}</a>
                        </div>
                    </div>
                    <ul class="sidebar-menu" data-widget="tree">
                        <li class="header">导航列表</li>
                        {volist name="__MENU__" id="menu"}
                        <li class="{present name="menu['_child']"}treeview{/present} {if count($menus_curr) egt 1 AND $menus_curr[0] eq $menu['id']} active{/if}">
                            <a href="{:url($menu.url)}">
                                <i class="{if $menu['icon']}{$menu.icon}{else /}fa fa-circle-o{/if}"></i> <span>{$menu.title}</span>
                                {present name="menu['_child']"}
                                <span class="pull-right-container">
                                    <i class="fa fa-angle-left pull-right"></i>
                                </span>
                                {/present}
                            </a>
                            {present name="menu['_child']"}
                            <ul class="treeview-menu">
                                {volist name="menu['_child']" id="mvo"}
                                <li class="{present name="mvo['_child']"}treeview{/present} {if count($menus_curr) egt 2 AND $menus_curr[1] eq $mvo['id']} active{/if}">
                                    <a href="{:url($mvo.url)}">
                                        <i class="{if $mvo['icon']}{$mvo.icon}{else /}fa fa-circle-o{/if}"></i> <span>{$mvo.title}</span>
                                        {present name="mvo['_child']"}
                                        <span class="pull-right-container">
                                            <i class="fa fa-angle-left pull-right"></i>
                                        </span>
                                        {/present}
                                    </a>
                                    {present name="mvo['_child']"}
                                    <ul class="treeview-menu">
                                        {volist name="mvo['_child']" id="vo"}
                                        <li class="{present name="vo['_child']"}treeview{/present} {if count($menus_curr) egt 3 AND $menus_curr[2] eq $vo['id']} active{/if}">
                                            <a href="{:url($vo.url)}">
                                                <i class="{if $vo['icon']}{$vo.icon}{else /}fa fa-circle-o{/if}"></i> <span>{$vo.title}</span>
                                                {present name="vo['_child']"}
                                                <span class="pull-right-container">
                                                    <i class="fa fa-angle-left pull-right"></i>
                                                </span>
                                                {/present}
                                            </a>
                                            {present name="vo['_child']"}
                                            <ul class="treeview-menu">
                                                {volist name="vo['_child']" id="v"}
                                                <li class="{if count($menus_curr) egt 4 AND $menus_curr[3] eq $v['id']} active{/if}">
                                                    <a href="{:url($v.url)}">
                                                        <i class="{if $v['icon']}{$v.icon}{else /}fa fa-circle-o{/if}"></i> <span>{$v.title}</span>
                                                    </a>
                                                </li>
                                                {/volist}
                                            </ul>
                                            {/present}
                                        </li>
                                        {/volist}
                                    </ul>
                                    {/present}
                                </li>
                                {/volist}
                            </ul>
                            {/present}
                        </li>
                        {/volist}
                    </ul>
                </section>
            </aside>
            <!-- /左侧导航 --> 
            {/block}
            <!-- 主体 --> 
            <div class="content-wrapper">
                <section class="content-header">
                    <h1>
                        {$meta_title}
                    </h1>
                </section>
                <section class="content">
                    {block name="main_body"}{/block}
                </section>
            </div>
            <!-- /主体 --> 
            {block name="footer"}
            <!-- 底部 --> 
            <footer class="main-footer">
                <div class="pull-right hidden-xs">
                    <b>Version</b> {$Think.config.config.version}
                </div>
                <strong>Copyright &copy; 2014-{:date('Y', time())} <a href="{:is_url()}">CuiCMF管理系统</a>.</strong> All rights
                reserved.
            </footer>
            <!-- /底部 --> 
            {/block}
            {block name="footer_set"}
            <!-- 设置 --> 
            <aside class="control-sidebar control-sidebar-dark">
                <div class="tab-content">
                    <div class="tab-pane" id="control-sidebar-home-tab">
                    </div>
                </div>
            </aside>
            <!-- /设置 -->
            <div class="control-sidebar-bg"></div>
            {/block}
        </div>
        <div class="modal fade" id="modal-change-password">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">修改密码</h4>
                    </div>
                    <form action="{:url('User/change_password')}" method="post" class="cui_from_change">
                        <div class="modal-body">
                            <div class="form-group has-feedback">
                                <input type="text" id="password" class="form-control" name="password" placeholder="请输入当前密码">
                                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                            </div>
                            <div class="form-group has-feedback">
                                <input type="text" id="new_password" class="form-control" name="new_password" placeholder="请输入新密码">
                                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                            </div>
                            <div class="form-group has-feedback">
                                <input type="text" id="confirm_password" class="form-control" name="confirm_password" placeholder="确认新密码">
                                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default pull-left" data-dismiss="modal">关闭</button>
                            <button type="submit" class="btn btn-primary ajax-post submit" target-form="cui_from_change">修改</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {/block}
        <!-- 核心jquery库 -->
        {js href="__STATIC__/jquery-3.2.1.min.js" /}
        <!-- /核心jquery库 -->
        <script type="text/javascript">
            $(function(){
                $('body').addClass('skin-blue sidebar-mini');
                window['img'] = '__IMG__';
                window['static'] = '__STATICS__';
            });
        </script>
        {block name="timeout"}
            <script type="text/javascript">
                $(function(){
                    setInterval(function() {
                        loginLosetime()
                        console.log('setInterval');
                    }, 60000 * 30);
                });
                // 登录超时检测
                function loginLosetime(){
                    $.get("{:url('Login/timeout')}", function(res){
                        console.log(res);
                        if(res.code == 0){
                            window.location.href = res.url;
                        }
                    });
                }
            </script>
        {/block}
        <!-- Bootstrap核心js -->
        {js href="__JS__/bootstrap.min.js" /}
        <!-- /Bootstrap核心js -->
        <!-- FastClick -->
        {js href="__JS__/fastclick/fastclick.js" /}
        <!-- /FastClick -->
        <!-- AdminLTE App -->
        {js href="__JS__/adminlte.min.js" /}
        <!-- /AdminLTE App -->
        <!-- SlimScroll -->
        {js href="__JS__/jquery-slimscroll/jquery.slimscroll.min.js" /}
        <!-- /SlimScroll -->
        <!-- layer弹窗 -->
        {js href="__STATIC__/layer/layer.js" /}
        <!-- /layer弹窗 -->
        <!-- jquery.form库 -->
        {js href="__STATIC__/jquery.form.js" /}
        <!-- 扩展javascript -->
        {block name="script"}{/block}
        <!-- 自定义js -->
        {js href="__JS__/common.js" /}
    </body>
</html>